variables:
  # NOTE: these must be used in most-specific to least-specific order.
  # <https://yaml.org/type/merge.html>
  #     "Keys in mapping nodes earlier in the sequence override keys specified in later mapping nodes."
  subsample:
    defaults: &subsample_defaults
      exclude: "config/outliers_ppx.txt"
      exclude_where:
        - qc.overallStatus=bad
      group_by:
        - year
        - country

    genome: &subsample_genome
      min_length: 10000
      query: genome_coverage>0.3 & missing_data<1000
    G: &subsample_G
      min_length: 600
      query: G_coverage>0.3 & missing_data<1000
    F: &subsample_F
      min_length: 1200
      query: F_coverage>0.3 & missing_data<1000

    recent_base: &recent_base
      max_sequences: 3000

    background_base: &background_base
      exclude_where:
        - qc.overallStatus=bad
        - qc.overallStatus=mediocre
      max_sequences: 300

    all-time: &subsample_all-time
      min_date: 1975-01-01
      max_sequences: 3000
    6y_recent: &subsample_6y_recent
      <<: *recent_base
      min_date: 6Y
    6y_background: &subsample_6y_background
      <<: *background_base
      max_date: 6Y
    3y_recent: &subsample_3y_recent
      <<: *recent_base
      min_date: 3Y
    3y_background: &subsample_3y_background
      <<: *background_base
      max_date: 3Y


conda_environment: "workflow/envs/nextstrain.yaml"

genesforglycosylation: ["G", "F"]

builds_to_run: ["genome", "G", "F"]

resolutions_to_run: ["all-time", "6y", "3y"]

description: "config/description.md"

strain_id_field: "accession"
display_strain_field: "strain"

subtypes: ['a', 'b']

# Use 'custom_subsample' instead of 'subsample' to define your own augur
# subsample config¹ per build.
# ¹ <https://docs.nextstrain.org/projects/augur/en/stable/usage/cli/subsample.html#configuration>
subsample:
  genome/all-time:
    samples:
      all-time:
        <<: [*subsample_genome, *subsample_all-time, *subsample_defaults]
  genome/6y:
    samples:
      recent:
        <<: [*subsample_genome, *subsample_6y_recent, *subsample_defaults]
      background:
        <<: [*subsample_genome, *subsample_6y_background, *subsample_defaults]
  genome/3y:
    samples:
      recent:
        <<: [*subsample_genome, *subsample_3y_recent, *subsample_defaults]
      background:
        <<: [*subsample_genome, *subsample_3y_background, *subsample_defaults]
  G/all-time:
    samples:
      all-time:
        <<: [*subsample_G, *subsample_all-time, *subsample_defaults]
  G/6y:
    samples:
      recent:
        <<: [*subsample_G, *subsample_6y_recent, *subsample_defaults]
      background:
        <<: [*subsample_G, *subsample_6y_background, *subsample_defaults]
  G/3y:
    samples:
      recent:
        <<: [*subsample_G, *subsample_3y_recent, *subsample_defaults]
      background:
        <<: [*subsample_G, *subsample_3y_background, *subsample_defaults]
  F/all-time:
    samples:
      all-time:
        <<: [*subsample_F, *subsample_all-time, *subsample_defaults]
  F/6y:
    samples:
      recent:
        <<: [*subsample_F, *subsample_6y_recent, *subsample_defaults]
      background:
        <<: [*subsample_F, *subsample_6y_background, *subsample_defaults]
  F/3y:
    samples:
      recent:
        <<: [*subsample_F, *subsample_3y_recent, *subsample_defaults]
      background:
        <<: [*subsample_F, *subsample_3y_background, *subsample_defaults]

files:
  auspice_config: "config/auspice_config.json"
  auspice_config_additional_colorings: "config/auspice_config_additional_colorings.json"

refine:
  coalescent: "opt"
  date_inference: "marginal"
  clock_filter_iqd: 4

ancestral:
  inference: "joint"

cds:
  F: "F"
  G: "G"
  genome: "F"

traits:
  columns: "country"

frequencies:
  resolutions:
    all-time:
      min_date: 1975-01-01
    6y:
      min_date: 6Y
    3y:
      min_date: 3Y

nextclade_attributes:
  a:
    name: "RSV-A NextClade using real-time tree"
    reference_name: "hRSV/A/England/397/2017"
    accession: "EPI_ISL_412866"
  b:
    name: "RSV-B NextClade using real-time tree"
    reference_name: "hRSV/B/Australia/VIC-RCH056/2019"
    accession: "EPI_ISL_1653999"
